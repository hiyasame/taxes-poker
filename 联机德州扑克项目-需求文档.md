## 联机德州扑克项目-需求文档

## 要求

- 前端风格美观，强制使用手机窗口大小，只适配移动端，PC 的 UI 也是移动端 UI，窗口大小也是移动端大小。
- 完整实现游戏规则，游戏逻辑尽量收束到后端，前端只负责展示
- 后端不要提供多余的信息给前端，比如未翻开的公牌，考虑安全性
- 后端提供完备的单元测试，覆盖全部功能，包括玩家进入大厅/退出大厅，游戏下注/赢牌/输牌等
- 请先完成后端，通过所有单元测试后再开始开发前端
- 前端要求根据当前已有的公牌和私牌推断当前的牌型（高牌/对子/两对/三条等）并展示出来供参考
- 要求游戏UI语言使用中文，并且对每个玩家展示的页面应该不同（自己应该在牌桌的中央，展示公牌和私牌的位置应该是一样的），注意可以采用约束布局类似的思路，一定不要出现 UI 错位和覆盖的情况，
- 做一个等待开始游戏的状态，玩家数量=1时自动回退到等待开始游戏状态。

## 游戏规则

> 参考 https://en.wikipedia.org/wiki/Texas_hold_%27em

德州扑克不使用[鬼牌](https://zh.wikipedia.org/wiki/鬼牌)，只使用52张扑克牌，是一种换牌扑克游戏，每位牌手发两张牌面朝下的“底牌”，是每个牌手唯一的个人牌，只能在“斗牌”时翻开。

以下叙述假定读者熟悉一般扑克玩法和[扑克牌型](https://zh.wikipedia.org/wiki/撲克牌型)。相关基本介绍参见[扑克](https://zh.wikipedia.org/wiki/撲克)、扑克牌型、[扑克机会率](https://zh.wikipedia.org/w/index.php?title=撲克機會率&action=edit&redlink=1)和[扑克术语](https://zh.wikipedia.org/w/index.php?title=撲克術語&action=edit&redlink=1)。

### 牌局进行流程

第一轮前先决定座位及起始发牌位置。

1. 洗牌并[切牌](https://zh.wikipedia.org/wiki/切牌)。
2. 本次轮到担任盲注的牌手们下盲注。
3. 为每位牌手发两张底牌。
4. 翻牌前（preflop）喊注。
5. 消一张牌后发出三张公共牌。
6. 翻牌圈（flop）喊注。
7. 消一张牌后发出一张公共牌（转牌）。
8. 转牌圈（turn）喊注。
9. 消一张牌后发出一张公共牌（河牌）。
10. 河牌圈（river）喊注。
11. 若有两家或以上未盖牌则斗牌比大小，依胜负分配总彩金。
12. 结束本回合，庄家位置依顺时钟次序移动至下一家进行下一轮。

### 座位分配方式与发牌次序

一般扑克锦标赛的座位均采取随机分配，除扑克室另有规定外，私人游戏多以抽牌比大小决定起始座位顺序及第一个发牌者位置。抽牌选位的方法为每人发一张牌，抽到最大牌者为庄家，当有两人以上抽到最大的牌（不比花色），重新抽牌直到其中一位牌手独大为起始庄家。每一轮结束后，庄家依顺时针方向由牌手依序轮流担任。 下盲注（blinds）及切牌后进行发牌，无论是否由[专属发牌者](https://zh.wikipedia.org/wiki/荷官)或牌手发牌，皆由按钮（dealer button）位置的下家(小盲注，SB)开始，依顺时钟方向派发，每轮一张共两轮，每一个参加的牌手都会得到两张底牌。[Howard Lederer](https://zh.wikipedia.org/w/index.php?title=Howard_Lederer&action=edit&redlink=1)于其教学DVD：Secrets of No-Limit Hold'em中建议由牌手担任发牌者进行发牌时，由发牌者之上上家进行[洗牌](https://zh.wikipedia.org/wiki/洗牌)，由发牌者之上家(CO位子，Cut-off)，进行[切牌](https://zh.wikipedia.org/wiki/切牌)，以降低作弊风险。

### 下注次序

第一轮下注称为“翻牌前”（preflop），由下大盲注下家的牌手开始喊注（如无盲注，则为发牌人左方的牌手），以顺时针方向继续。

各圈喊注将持续直至每个牌手都已为以下三种状态之一：

1. 盖牌（fold），即舍弃并覆盖手中的牌，放弃已投入底池的筹码退出该局。
2. 跟注（call）投入了与所有其他未盖牌的牌手等量的筹码。
3. 全下（all-in），投入了尚余的全部筹码。

在“翻牌前”下注结束后，假使有至少两名牌手未盖牌，为防止作弊，发牌人须先将牌堆的最上面一张牌作废覆盖于牌桌上（此动作称为销牌（Burn Card）），再于牌桌上发出并同时翻开三张公共牌，然后开始第二轮（“翻牌”，flop）下注。这一轮及其后的下注，都是由发牌人后第一个尚未盖牌的牌手开始，以顺时针方向继续进行喊注。

“翻牌”下注结束后，发牌人须再销牌后，发出另一张公共牌，称为“转牌”（turn）（或“第四街”），开始第三轮下注。然后发牌人须再销牌，发出最后一张公共牌，称为“河牌”（river）（或“第五街”），之后开始第四轮下注。如有多于一名以上的牌手未盖牌持续到最后则须[斗牌比大小（showdown）](https://zh.wikipedia.org/wiki/德州撲克#鬥牌方式)。

### 下注形式

[![img](https://upload.wikimedia.org/wikipedia/commons/thumb/c/c0/Texas_Hold%27em_Poker_Table_with_Blinds.svg/500px-Texas_Hold%27em_Poker_Table_with_Blinds.svg.png)](https://zh.wikipedia.org/wiki/File:Texas_Hold'em_Poker_Table_with_Blinds.svg)标准德州扑克游戏盲注的位置，小盲注与大盲注紧接于发牌者之后

德州扑克通常规定大小两个盲注（也可兼用底注（ante），特别在是扑克赛较后阶段）。坐在发牌人（dealer）位置的牌手，前面有按钮作标示。发牌人按钮每局以顺时针方向移动一个位置，发牌人和盲注位置随之变动。位于发牌人顺时针方向次一位置的牌手须下小盲注（small blind），金额等于大盲注（big blind）的一半。小盲注牌手的下一家的牌手须下大盲注，金额等于最低下注额。

在扑克比赛中，盲注/底注的金额会随时间逐渐提高。有时大小盲注有不同比例，例如大小盲注分别为15元和10元也十分正常。“双盲注制”在1980年代后较为流行，1980年代以前则是以单盲注制较为普遍。

如只剩两名牌手，“一对一”（heads-up）特别规则会生效，盲注的位置会有所不同。在这个情况下，发牌人下小盲注，而他的对手须下大盲注，只有第一轮由发牌者先叫注，翻牌后的各轮皆由大盲注先行叫注。

德州扑克最常见的三个变种为限注（limit）、无限注（no-limit）和彩池限注（pot-limit）。美国赌场最流行的曾是限注德州扑克[[1\]](https://zh.wikipedia.org/wiki/德州撲克#cite_note-15stud-1)。

#### 最低加注金额限制

在所有种类的德州扑克中，加注必须等于或高于该圈最后一个加注牌手的加注金额，若该圈尚未有牌手加注，则加注金额必需大于或等于大盲注。例如：如第一位牌手由0加注为$10，第二位牌手的最少需加注$10 （总押注为$20）。

##### All-in后未达最低加注额时的重新加注限制

依赌场规则而异，若所余筹码All-in后仍低于最低加注金额，则此注仅视为跟注（call）而不能被当成加注（raise），亦及该圈若未有其他人再加注，则原加注者（此例中的第一位牌手）仅可跟注补齐或盖牌，于此圈不可再行加注；亦有少部分赌场规定All-in后大于最低加注额的一半以上，原加注者即可重新加注。或是规定连续All-in累积的筹码量已超过了最小下注或加注额后，原加注者即可重新加注。例如：A下注500，B加注到1000，C跟注1000，D持1300筹码All-in（增加的注额为300，小于最低加注额500，不被视为加注），E持1700筹码All-in（增加的注额为400，小于最低加注额500，不被视为加注）。若牌桌依累积增加的注额大于加注额（500）可再加注的规定，当A跟注或弃牌，B或C仍可以选择再加注。加注的最小额度是上一次完整加注额。在上述例子中，最后一个完整加注额是500，因此选手B或C可以跟注至1700，或者再加注到2200以上。

各种下注规则请参看[主要的德州扑克类型下注差异与例子](https://zh.wikipedia.org/wiki/德州撲克#主要的德州撲克類型下注差異與例子)。

### 斗牌方式

如一名牌手加注，而其他所有牌手均盖牌，则此牌手无需开牌，可直接赢得彩池中所有筹码。如有两名以上的牌手在最后一轮下注结束时仍未盖牌，则须进行斗牌。斗牌时，每名牌手以自己的两张底牌，加上桌面五张公共牌，共七张牌中，取最大的五张牌组合决定胜负，当中可包括两张或一张底牌，甚至只有公共牌。其余的两张不列入比较范围，如使用的五张全是公共牌，牌手最多只能希望和其他牌手对分彩池，因为其他牌手也必定能以公共牌组成同样的手牌。

某五张公用牌翻开后，可判定该局的“最佳手牌”（nut hand）。例如，如桌面翻开了2-3-7-8-Q，如公牌中没有三张以上花色相同，“最佳手牌”即为一对Q，可与公牌组成最大的三条牌型7-8-Q-Q-Q。

如多于一名牌手拥有最大的手牌，彩池会由他们平等均分，不能平分的零头数筹码由发牌者后依顺时针方向，尚未盖牌的第一个牌手获得(即位置相对最不利者)。很多时候牌手拥有牌型大小相若的手牌，但并非一模一样，须以次大牌（kicker）决定胜负，若次大牌相同则依序比到使用的五张为止。譬如说斗牌时剩下两未盖牌牌手A及B，A持有底牌为J-8，B持有底牌9-8，公共牌为6-7-8-Q-K时，若A、B均未有同花牌型时，此时A、B两牌手均持有一对8，但A组成牌型为8-8-K-Q-J，B则为8-8-K-Q-9，此时为A牌手获胜，此例中若公牌改为7-8-K-Q-A，则A与B组成牌型均为8-8-A-K-Q，未使用的牌不参与比较，此时即为平手，A及B依投注金额分配彩池筹码，须注意，斗牌时只计算数字，花色在德州扑克中无分大小。

#### 开牌次序

牌手开牌与否依扑克室的规则而略有不同，常见的有：

- 未盖牌牌手可依序自行决定是否开牌。
- 跟到最后的未盖牌牌手才可要求未盖牌者开牌。
- 有跟到转牌圈的牌手可要求未盖牌者开牌。
- 任何牌手（包含已盖牌者）皆可要求未盖牌者开牌。

其中以【未盖牌牌手自行决定是否开牌】最常被使用，开牌的顺序为最后一圈的最后加注者为第一开牌者，若所有的牌手都All-in，则由第一个All-in的牌手为第一开牌者，然后依序采顺时钟方向，未盖牌牌手可自行决定是否开牌（亦可盖牌放弃，称为muck），一旦决定开牌则需两张牌都翻出，只开一张等同放弃开牌（盖牌），若最后一圈未有牌手加注，则以按钮位置顺时针方向第一家尚未盖牌者为第一开牌者，依顺时钟次序进行开牌。

### 彩池分配

当没有牌手全押(all-in)时，彩池由未盖牌的牌手中牌型最大的者独得。当有一或多个牌手全押时，德州扑克的彩池分配较为复杂，超过牌手押注金额的部分将会形成一或多个边池。牌手参与投注该彩池才有机会于该彩池胜出分配奖金。当一局结束而且所有已“全押”的牌手未持有最大牌型时，边池（side pot）和主池（main pot）皆由牌面最佳获胜的牌手赢得。 当一局结束而且有“全押”的牌手赢牌时，该牌手有参与投注的主池边池奖金均归该牌手，而其他边池由参与该边池投注里，持有最大牌面的牌手赢得。在几个牌手全押形成多个边池时，依全押的顺序分配给各边池中最佳牌面的牌手，有最大牌面的牌手赢得该牌手全押前所累积的边池。 已全押之牌手无法赢取全押后形成之彩池，亦及最多只能自其他每个跟牌之牌手处取得相当于本身全押之总筹码数，全押后之下注可视为只在之后参与的牌手之间的独立输赢分配。 无人跟注的边池（仅有一位牌手下注，剩下其他牌手都盖牌）将会直接赢得该边池，形同退还下注于该边池之筹码。

#### 彩池分配范例

例如ABCDEF六名牌手参与牌局，F于中途盖牌退出，最终A全押投入$50，B全押投入$250，C全押投入$350，DE各投入$800，F投入$500，此时总彩池大小为$2750，形成了一个主池为50*6=$300，边池各为（250-50）*5=$1000，（350-250）*4=$400，（500-350）*3=$450，（800-500）*2=$600，若最终组成牌面大小为F>A>B>D>E>C，但F已盖牌不能分配任何彩池，则此局主池即为A于此局赢得的筹码（$300），B可赢得第一个边池（$1000），D参与至最后一个边池，且牌面胜过参与第二、第三及第四边池的所有牌手，因此可赢得剩下所有的边池（400+450+600=$1450）

#### 彩池无法均分时的小额筹码分配

当彩池由两个以上牌手平分时，若有无法平分之小额筹码，由顺时钟方向算过去，最靠近发牌者的赢家取得，举例来说有ABCDE依顺时钟方向入座，A为本局发牌者，最小面额筹码为$10，所有牌手皆未盖牌至斗牌，最终由CDE胜出平分本局彩池$1000时，则DE各分到$330，而多出的$10将分配给最靠近A的赢家C，C于本局可分到$340。

### 牌型大小规则

德州扑克的牌型大小与一般扑克、[梭哈](https://zh.wikipedia.org/wiki/梭哈)、[十三张](https://zh.wikipedia.org/wiki/十三張)、换牌扑克等等的扑克牌型大小顺序相似，但牌型大小不分花色，牌手有可能平手，从大到小比牌（如：都有一对，数字大的胜出；数字相同，则是剩下的杂牌一张张比数字大小）。若五张比完大小相同，则均分彩池内的筹码。

一般德州扑克牌型大小依序为：皇家同花顺 > 同花顺 > 四条（铁支） > 葫芦 > 同花 > 顺子 > 三条> 两对 > 对子 > 散牌。

但部分变种德州扑克，如短牌德州扑克等，因不使用部分纸牌，造成几率变动，而有不同的牌型大小规定。

- 同花大顺（皇家同花顺或最大同花顺，Royal Straight Flush）

- 同花顺（Straight Flush）

- 铁支（四条，Four of a kind）

- 葫芦（夫佬或满堂红，Full house）

- 同花（Flush）

- 顺子（Straight）

- 三条（Three of a kind）

- 两对（Two pair）

- 对子（Pair）

- 高牌（高牌或散牌, High card，No-pair，Zilch）
